source /usr/share/zsh/config/zshrc
export PROMPT='$CYAN%n@$YELLOW$(hostname):$FG[039]$GREEN$(_fish_collapsed_pwd)%f > '
export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/.local/clangd/clangd_19.1.2/bin:$PATH"

# =============================================================================
# ä»£ç†å¼€å¯å…³é—­å¿«æ·å‘½ä»¤
# =============================================================================

# ä»£ç†æœåŠ¡å™¨é…ç½® (æ ¹æ®ä½ çš„å®é™…ä»£ç†æœåŠ¡å™¨ä¿®æ”¹)
PROXY_HOST="10.0.11.100"
PROXY_PORT="7890"
PROXY_URL="http://${PROXY_HOST}:${PROXY_PORT}"

# å¼€å¯ä»£ç†
function proxy_on() {
    export http_proxy="${PROXY_URL}"
    export https_proxy="${PROXY_URL}"
    export HTTP_PROXY="${PROXY_URL}"
    export HTTPS_PROXY="${PROXY_URL}"
    export ftp_proxy="${PROXY_URL}"
    export FTP_PROXY="${PROXY_URL}"
    export all_proxy="${PROXY_URL}"
    export ALL_PROXY="${PROXY_URL}"
    
    # è®¾ç½®ä¸èµ°ä»£ç†çš„åœ°å€ (æœ¬åœ°åœ°å€å’Œå†…ç½‘åœ°å€)
    export no_proxy="localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,172.16.0.0/12,::1"
    export NO_PROXY="localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,172.16.0.0/12,::1"
    
    echo "ğŸŒ ä»£ç†å·²å¼€å¯"
    echo "   HTTP Proxy:  ${http_proxy}"
    echo "   HTTPS Proxy: ${https_proxy}"
    echo "   No Proxy:    ${no_proxy}"
}

# å…³é—­ä»£ç†
function proxy_off() {
    unset http_proxy
    unset https_proxy
    unset HTTP_PROXY
    unset HTTPS_PROXY
    unset ftp_proxy
    unset FTP_PROXY
    unset all_proxy
    unset ALL_PROXY
    unset no_proxy
    unset NO_PROXY
    
    echo "ğŸš« ä»£ç†å·²å…³é—­"
}

# æŸ¥çœ‹ä»£ç†çŠ¶æ€
function proxy_status() {
    echo "ğŸ“¡ ä»£ç†çŠ¶æ€ï¼š"
    if [ -n "$http_proxy" ]; then
        echo "   âœ… ä»£ç†å·²å¼€å¯"
        echo "   HTTP:  ${http_proxy:-æœªè®¾ç½®}"
        echo "   HTTPS: ${https_proxy:-æœªè®¾ç½®}"
        echo "   No Proxy: ${no_proxy:-æœªè®¾ç½®}"
    else
        echo "   âŒ ä»£ç†å·²å…³é—­"
    fi
}

# æµ‹è¯•ä»£ç†è¿æ¥
function proxy_test() {
    if [ -n "$http_proxy" ]; then
        echo "ğŸ” æµ‹è¯•ä»£ç†è¿æ¥..."
        echo "å½“å‰ä»£ç†: ${http_proxy}"
        
        # æµ‹è¯•ä»£ç†æœåŠ¡å™¨æ˜¯å¦å¯è¾¾
        if curl -s --connect-timeout 5 --proxy "${http_proxy}" "http://www.google.com" > /dev/null; then
            echo "âœ… ä»£ç†è¿æ¥æ­£å¸¸"
        else
            echo "âŒ ä»£ç†è¿æ¥å¤±è´¥"
        fi
        
        # æ˜¾ç¤ºå½“å‰ IP
        echo "ğŸŒ å½“å‰å¤–ç½‘ IP:"
        curl -s --connect-timeout 10 --proxy "${http_proxy}" "https://ipinfo.io/ip" || echo "è·å– IP å¤±è´¥"
    else
        echo "âŒ ä»£ç†æœªå¼€å¯ï¼Œè¯·å…ˆè¿è¡Œ proxy_on"
    fi
}

# Git ä»£ç†è®¾ç½®
function git_proxy_on() {
    git config --global http.proxy "${PROXY_URL}"
    git config --global https.proxy "${PROXY_URL}"
    echo "âœ… Git ä»£ç†å·²å¼€å¯: ${PROXY_URL}"
}

function git_proxy_off() {
    git config --global --unset http.proxy
    git config --global --unset https.proxy
    echo "âœ… Git ä»£ç†å·²å…³é—­"
}

function git_proxy_status() {
    echo "ğŸ“¡ Git ä»£ç†çŠ¶æ€ï¼š"
    local git_http_proxy=$(git config --global --get http.proxy)
    local git_https_proxy=$(git config --global --get https.proxy)
    
    if [ -n "$git_http_proxy" ] || [ -n "$git_https_proxy" ]; then
        echo "   âœ… Git ä»£ç†å·²å¼€å¯"
        echo "   HTTP:  ${git_http_proxy:-æœªè®¾ç½®}"
        echo "   HTTPS: ${git_https_proxy:-æœªè®¾ç½®}"
    else
        echo "   âŒ Git ä»£ç†å·²å…³é—­"
    fi
}

# å¿«æ·åˆ«å
alias pon='proxy_on'           # å¼€å¯ä»£ç†
alias poff='proxy_off'         # å…³é—­ä»£ç†
alias pst='proxy_status'       # æŸ¥çœ‹ä»£ç†çŠ¶æ€
alias ptest='proxy_test'       # æµ‹è¯•ä»£ç†
alias gpon='git_proxy_on'      # å¼€å¯ Git ä»£ç†
alias gpoff='git_proxy_off'    # å…³é—­ Git ä»£ç†
alias gpst='git_proxy_status'  # æŸ¥çœ‹ Git ä»£ç†çŠ¶æ€

# è‡ªåŠ¨æ£€æµ‹å¹¶æç¤ºä»£ç†çŠ¶æ€
function check_proxy_on_startup() {
    if [ -n "$http_proxy" ]; then
        echo "ğŸŒ æ£€æµ‹åˆ°ä»£ç†å·²å¼€å¯: ${http_proxy}"
    fi
}

# å¯åŠ¨æ—¶æ£€æŸ¥ä»£ç†çŠ¶æ€
check_proxy_on_startup

# =============================================================================
# å¸¸ç”¨å¿«æ·å‘½ä»¤
# =============================================================================

# æ–‡ä»¶å’Œç›®å½•æ“ä½œ
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias ~='cd ~'
alias -- -='cd -'

# æ–‡ä»¶æŸ¥çœ‹å’Œç¼–è¾‘
alias cat='cat -n'          # æ˜¾ç¤ºè¡Œå·
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# ç³»ç»Ÿä¿¡æ¯
alias df='df -h'             # äººæ€§åŒ–æ˜¾ç¤ºç£ç›˜ä½¿ç”¨
alias du='du -h'             # äººæ€§åŒ–æ˜¾ç¤ºç›®å½•å¤§å°
alias free='free -h'         # äººæ€§åŒ–æ˜¾ç¤ºå†…å­˜ä½¿ç”¨
alias ps='ps auxf'           # è¯¦ç»†è¿›ç¨‹ä¿¡æ¯
alias top='htop'             # å¦‚æœæœ‰ htop å°±ç”¨ htop

# ç½‘ç»œå·¥å…·
alias ping='ping -c 5'       # é»˜è®¤ ping 5 æ¬¡
alias wget='wget -c'         # æ”¯æŒæ–­ç‚¹ç»­ä¼ 

# å®‰å…¨æ“ä½œ
alias rm='rm -i'             # åˆ é™¤å‰ç¡®è®¤

# å¿«é€ŸæŸ¥æ‰¾
alias f='find . -name'       # å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶
alias h='history | grep'     # åœ¨å†å²è®°å½•ä¸­æœç´¢

# è¿›ç¨‹ç®¡ç†
alias killall='pkill -f'     # æ ¹æ®åç§°æ€æ­»è¿›ç¨‹
alias ports='netstat -tulanp' # æŸ¥çœ‹ç«¯å£å ç”¨

echo "ğŸ‰ ä»£ç†ç®¡ç†å‘½ä»¤å·²åŠ è½½ï¼"
echo "ğŸ’¡ å¿«æ·å‘½ä»¤ï¼š"
echo "   pon/proxy_on     - å¼€å¯ä»£ç†"
echo "   poff/proxy_off   - å…³é—­ä»£ç†"
echo "   pst/proxy_status - æŸ¥çœ‹ä»£ç†çŠ¶æ€"
echo "   ptest/proxy_test - æµ‹è¯•ä»£ç†è¿æ¥"
echo "   gpon/git_proxy_on    - å¼€å¯ Git ä»£ç†"
echo "   gpoff/git_proxy_off  - å…³é—­ Git ä»£ç†"
echo "   gpst/git_proxy_status - æŸ¥çœ‹ Git ä»£ç†çŠ¶æ€"
echo "ğŸ“ å¸¸ç”¨å¿«æ·å‘½ä»¤å·²åŠ è½½: ll, .., f, h, ports ç­‰"
